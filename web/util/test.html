<table width="100%">
<tr>
<td width="30%"/>
<td id='mytd'>
	<div id="canvasDiv"></div>
</td>
</tr>
</table>
<input readonly id='records' type='text' size='10'/>
<input type='button' onclick='alert(document.getElementById("canvas").toDataURL().length);'/>
<script>
	var clickX = new Array();
	var clickY = new Array();
	var clickDrag = new Array();
	var paint;
	var context;
	var colorPurple = "#cb3594";
	var colorGreen = "#659b41";
	var colorYellow = "#ffcf33";
	var colorBrown = "#986928";
	var curColor = colorPurple;
	var clickColor = new Array();
	var clickSize = new Array();
	var curSize = 5;
	var clickTool = new Array();
	var curTool = "crayon";
	var canvasOffsetLeft;
	var canvasOffsetTop;
	
	function initCanvas(canvasWidth,canvasHeight){
		var canvasDiv = document.getElementById('canvasDiv');
		canvas = document.createElement('canvas');
		canvas.width=canvasWidth;
		canvas.height=canvasHeight;
		canvas.id='canvas';
		canvasDiv.appendChild(canvas);
		if(typeof G_vmlCanvasManager != 'undefined') {
			canvas = G_vmlCanvasManager.initElement(canvas);
		}
		ctx = canvas.getContext("2d");
		ctx.fillStyle='#ddd';
		ctx.fillRect(0, 0, canvasWidth, canvasHeight);

		<!-- Event listeners -->
		canvas.onmousedown = function(e){
			var activeElement=this;
			canvasOffsetLeft=0;
			canvasOffsetTop=0;
			while(activeElement.parentElement){
				canvasOffsetLeft+=activeElement.offsetLeft;
				canvasOffsetTop+=activeElement.offsetTop;
				activeElement=activeElement.parentElement;
			}
		  	paint = true;
		  	addClick(e.pageX - canvasOffsetLeft, e.pageY - canvasOffsetTop);
		  	redraw();
		};

		canvas.onmousemove = function(e){
			var activeElement=this;
			canvasOffsetLeft=0;
			canvasOffsetTop=0;
			while(activeElement.parentElement){
				canvasOffsetLeft+=activeElement.offsetLeft;
				canvasOffsetTop+=activeElement.offsetTop;
				activeElement=activeElement.parentElement;
			}
			if(paint){
			    addClick(e.pageX - canvasOffsetLeft, e.pageY - canvasOffsetTop, true);
			    redraw();
			}
		};
		
		canvas.onmouseup = function(e){
			paint = false;
		};
		
		canvas.onmouseleave = function(e){
			paint = false;
		};
		return ctx;
	}
	
	context = initCanvas(100,100);
	
	function addClick(x, y, dragging)
	{
		clickX.push(x);
		clickY.push(y);
		clickDrag.push(dragging);
		if(curTool == "eraser"){
			clickColor.push("white");
		}else{
		    clickColor.push(curColor);
		}		
		clickSize.push(curSize);
		document.getElementById("records").value=clickX.length;
	}
	
	function redraw(){
  		context.clearRect(0, 0, context.canvas.width, context.canvas.height);
  		context.fillStyle='#ddd';
  		context.fillRect(0, 0, context.canvas.width, context.canvas.width);
  		context.lineJoin = "round";
			
  		for(var i=0; i < clickX.length; i++) {		
    		context.beginPath();
    		if(clickDrag[i] && i){
      			context.moveTo(clickX[i-1], clickY[i-1]);
     		}else{
       			context.moveTo(clickX[i]-1, clickY[i]);
     		}
     		context.lineTo(clickX[i], clickY[i]);
     		context.strokeStyle = clickColor[i];
     		context.lineWidth = curSize;
     		context.closePath();
     		context.stroke();
  		}
	}
</script>